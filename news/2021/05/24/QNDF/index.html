<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/hypertext.css"> <link rel=icon  href="/assets/favicon.png"> <title>SciML Ecosystem Update: Improved QNDF Outperforms CVODE On SciMLBenchmarks</title> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-90474609-2'); </script> <header> <h1><b><center>SciML Scientific Machine Learning Software</center></b></h1> <nav> | <a href="/" class=current >Home</a> | <a href="/news/">News</a> | <a href="/roadmap/">Roadmap</a> | <a href="/citing/">Citing</a> | <a href="/showcase/">Showcase</a> | <a href="/challenge/">Challenge Problems</a> | <a href="/community/">Community</a> <hr/> | <a href="/documentation/">Documentation</a> | <a href="/dev/">Dev Programs</a> | <a href="/governance/">Governance</a> | <a href="https://benchmarks.sciml.ai/">Benchmarks</a> | <a href="https://github.com/SciML/">Source Code</a> | <a href="https://numfocus.org/donate-to-sciml">Donate</a> </nav> </header> <div class=franklin-content ><h1 id=sciml_ecosystem_update_improved_qndf_outperforms_cvode_on_scimlbenchmarks ><a href="#sciml_ecosystem_update_improved_qndf_outperforms_cvode_on_scimlbenchmarks" class=header-anchor >SciML Ecosystem Update: Improved QNDF Outperforms CVODE On SciMLBenchmarks</a></h1> <p>It has been a few months so there&#39;s a lot to update, especially in terms of performance improvements. But let&#39;s start with the announcement of how we have solved one of the longest running issues in the SciML universe.</p> <h2 id=qndf_improvements_replaces_cvode_in_recommendations_and_defaults ><a href="#qndf_improvements_replaces_cvode_in_recommendations_and_defaults" class=header-anchor >QNDF Improvements Replaces CVODE in Recommendations and Defaults</a></h2> <p>For context, let&#39;s look at the previous DifferentialEquations.jl documentation on how to choose a stiff ODE solver:</p> <blockquote> <p>For stiff problems at high tolerances &#40;&gt;1e-2?&#41; it is recommended that you use Rosenbrock23 or TRBDF2...</p> </blockquote> <p>Okay, it keeps on going and going. All of the methods it recommends are from OrdinaryDiffEq.jl though, which is all guided by <a href="https://github.com/SciML/SciMLBenchmarks.jl">the SciMLBenchmark results</a>.</p> <p>But at the very end of the recommendations you see:</p> <blockquote> <p>For asymptotically large systems of ODEs &#40;N&gt;1000?&#41; where f is very costly and the complex eigenvalues are minimal &#40;low oscillations&#41;, in that case CVODE<em>BDF will be the most efficient but requires Vector&#123;Float64&#125;. CVODE</em>BDF will also do surprisingly well if the solution is smooth. However, this method can handle less stiffness than other methods and its Newton iterations may fail at low accuracy situations. Another good choice for this regime is lsoda.</p> </blockquote> <p>In translation, &quot;if you happen to be in the asymptotically big case, you still need to make use of Sundials&quot;.</p> <p><strong>That is no more. The king has fallen. Long live QNDF.</strong></p> <p>For awhile, OrdinaryDiffEq.jl had a few BDF implementations, &#40;<code>ABDF2</code>, <code>QBDF</code>, <code>QNDF</code>, etc.&#41; but none of them stacked up to Sundials.jl in this regime. And BDF-type methods are just better suited for this regime than Rosenbrock, SDIRK, and FIRK methods which OrdinaryDiffEq.jl had already heavily optimized beyond the previous software. This domain though just keep being elusive.</p> <p>In 2017 Yingbo and I had many conversations on the right approach for this, and those ideas refined and converged over the years. Nordseick seems less numerically stable in comparison to divided differences when done correctly. Shampine&#39;s NDF seems like it should be an improvement over BDF, but there&#39;s no high performance implementations. Etc. Putting all of this together, Yingbo had pieces of these ideas implemented over 8 repos in the span of the 4 years moving towards this idea. In 2018, a GSoC student implemented a &quot;from the textbook&quot; NDF, the previous <code>QNDF</code>, which did admirably but didn&#39;t match CVODE.</p> <p>But it kept marching on in many ways. OrdinaryDiffEq.jl started to use its own <a href="https://github.com/YingboMa/RecursiveFactorization.jl">pure Julia implemented BLAS routines</a>, having all sorts of <a href="https://github.com/YingboMa/FastBroadcast.jl">auto-optimizing SIMD</a>, etc. Finally, on May 22, 2021, Yingbo with a new summer student, Junpeng Gao &#40;@JunpengGao233&#41;, cracked the code. They pair programed and ended up with <a href="https://github.com/SciML/OrdinaryDiffEq.jl/pull/1411">this mega PR</a>. The result? In <a href="https://github.com/SciML/SciMLBenchmarks.jl">the entire SciMLBenchmarks</a>, <code>QNDF</code> matches or outperforms <code>CVODE_BDF</code>. It ranges from 20 stiff ODEs with POLLU:</p> <p><img src="https://user-images.githubusercontent.com/1814174/119265210-dca0d500-bbb3-11eb-9486-9485b88db2a2.png" alt="" /></p> <p>to 1,000 stiff ODEs with BCR:</p> <p><img src="https://user-images.githubusercontent.com/17304743/119210963-6f8b2380-ba7d-11eb-839a-017423723acd.png" alt="" /></p> <p>and on a difficult 8,000 equation HVAC model, we saw it taking larger steps, less Jacobians, and factorizing less:</p> <p><img src="https://user-images.githubusercontent.com/1814174/119265211-dca0d500-bbb3-11eb-82f0-fd3049a64b33.png" alt="" /></p> <p>Across the board we saw the dream had finally come together, with all of the pieces in handfuls of different repositories coming together to give a new great algorithm. Because of this, the automated algorithm selection of DifferentialEquations.jl v6.17 no longer chooses <code>CVODE_BDF</code> in any scenario. As <code>CVODE_Adams</code> is always outperformed in the benchmarks by either <code>Tsit5</code>, <code>Vern7</code>, <code>Vern9</code>, or <code>VCABM</code>, and <code>ARKODE</code> is outperformed by the same or <code>KenCarp47</code> or <code>TRBDF2</code>, the benchmarks, recommendations, and automated algorithm choices no longer make use of Sundials.jl.</p> <p>The importance of this cannot be understated. Working with a C&#43;&#43; code binding always had limitations in the special linear solvers that could be used, interactions with the JIT compiler, <a href="https://github.com/SciML/DiffEqGPU.jl">the ability to work with CUDA and AMDGPUs in a automatic way</a>, the ability to differentiate through the solver. By having the dominant algorithm as pure Julia, all of these issues are now solved as it interacts with the compiler in a native way. This will be important as it allows automating the development of multi-GPU MPI codes &#40;coming soon&#33;&#41;, further expanding the reach of &quot;asymptotically large systems&quot;.</p> <p>Sundials is absolutely fantastic, it should be applauded that in a 300 solver implementation effort with over 100 developers involved in many commits, with over 100 repositories and entire funded teams and labs helping to improve various aspects over 5 years, <code>CVODE_BDF</code> stood strong as unbeatable in an important category even while we had repeatedly attempted to find ways to unseat it. But, sooner or later it had to be overcome, and that time has come. We are very thankful to the developers of Sundials as their decades of code and writings have been immensely helpful in unpacking this subject, and we hope to contribute to this area of ODEs as much as they have. But for now, Julia uses can rejoice as if they are solving systems of more than 1,000 ODEs, they will get a free speed boost, a feature boost, and a reduced dependency chain.</p> <h3 id=is_this_the_end_of_sundialsjl_no ><a href="#is_this_the_end_of_sundialsjl_no" class=header-anchor >Is this the end of Sundials.jl? No</a></h3> <p>Seeing these advancements, people have asked me this question pertaining to maintenance of legacy code. Let it be stated directly:</p> <p><strong>SciML is committed to maintaining legacy solver libraries</strong></p> <p>In 2021 you can still use <a href="https://github.com/SciML/ODE.jl">ODE.jl on Julia v1.6</a>, the solvers built 3 years before the creation of DifferentialEquations.jl. They are locked in time giving the same answers at the same speed, allowing ease of code updating.</p> <p>Sundials.jl will likely evolve similarly. We still note that <code>CVODE_BDF</code> is still worth trying in many cases, and it will likely have instances where it outperforms <code>QNDF</code>, as every method is optimized in different ways. To be clear, the reason for the recommendation change is because over a large array of equations we see a very general pattern of preferring <code>QNDF</code>, though there will always be exceptions to the rule and so <code>CVODE_BDF</code> will still have a place in the DifferentialEquations.jl arsenal, just a very reduced one from the position it held before.</p> <p>That said, the advancement of <code>QNDF</code> means there will likely be no attempts to connect to Sundials CUDA support, but what is there will continue to be maintained. It&#39;s built with fancy LAPACK options, KLU integration, etc. and it will continue to stay that way. It will be updated and its tests will keep passing. But it will likely not capture as much developer focus.</p> <p>There is one more thing to make note of. There is still one place in the entire DifferentialEquations.jl universe where a Sundials algorithm still reigns supreme as the recommended algorithm over any pure Julia method, and that is not in ODEs but DAEs. <code>IDA</code> is still unmatched in the pure Julia space. While it&#39;s routinely outperformed if you have a DAE written in mass matrix form of a certain size, <a href="https://diffeq.sciml.ai/stable/solvers/dae_solve/#Recommended-Methods">giving rise to the recommendations of OrdinaryDiffEq.jl in many DAE cases</a>, <code>IDA</code> is still unmatched when you have a fully-implicit or asymtopically large DAE definition. That will change. Junpeng Gao&#39;s summer project, under the mentorship of Yingbo, will be to similarly build a pure Julia BDF/NDF for fully-implicit DAEs into OrdinaryDiffEq.jl, aiming to similarly extensive benchmark and outperform <code>IDA</code> by the end of the summer using the same tricks as <code>QNDF</code>. When that is completed, we will finally flip the <a href="https://www.stochasticlifestyle.com/comparison-differential-equation-solver-suites-matlab-r-julia-python-c-fortran/">last yellow box on DifferentialEquations.jl</a> and end a half-decade &gt;100 developer project to essentially have 99&#37; of cases most optimally use a pure Julia solver, optimized using the latest techniques from the literature and purpose-built for the latest hardware. And that will be a major congratulations to everyone who has been involved in this journey.</p> <h2 id=symbolicsjl_e-graph-based_floating_point_cycles_minimization ><a href="#symbolicsjl_e-graph-based_floating_point_cycles_minimization" class=header-anchor >Symbolics.jl E-Graph-Based Floating Point Cycles Minimization</a></h2> <p>If you missed the release of the new <a href="https://juliasymbolics.org/">JuliaSymbolics Organization</a>, please check it out. It&#39;s a &quot;daughter organization&quot; with pieces spun out of SciML since the symbolic computing became a world of its own. The <a href="https://juliasymbolics.org/roadmap/">Symbolics.jl roadmap</a> and <a href="https://discourse.julialang.org/t/ann-symbolics-jl-a-modern-computer-algebra-system-for-a-modern-language/56251">release announcement of Symbolics.jl</a> received a ton of fanfare. We thank the community for the warm welcoming&#33;</p> <p>Since that time, Symbolics.jl has been moving rapidly with a lot of help of Shashi Gowda &#40;@shashi&#41; and the new developer team that the new organization has brought in. To highlight this, check out <a href="https://arxiv.org/abs/2105.03949">the recently released publication on Symbolics.jl</a>. It showcases how E-graph approaches of <a href="https://github.com/0x0f0f0f/Metatheory.jl">Metatheory.jl</a> combined with symbolic simplification can give rise to a mechanism for automatically simplifying code into the form which takes the least floating point cycles. Symbolics.jl will be a fantastic symbolic-numerics tool for the SciML community. We note that ModelingToolkit.jl will stay in SciML, and is now built on top of the fully documented Symbolics.jl computer algebra system.</p> <h2 id=modelingtoolkit_outperforms_simulink_by_15000x_on_nasa_launch_services_application ><a href="#modelingtoolkit_outperforms_simulink_by_15000x_on_nasa_launch_services_application" class=header-anchor >ModelingToolkit Outperforms Simulink by 15,000x on NASA Launch Services Application</a></h2> <p>Speaking of ModelingToolkit.jl, SciML user Jonnie Diegelman gave an enlightening talk at SIAM CSE 2021 on how SciML tools are used by him to accelerate about 15,000x over Simulink. See the talk for yourself&#33;</p> <center> <iframe width=560  height=315  src="https://www.youtube.com/embed/tQpqsmwlfY0" title="YouTube video player" frameborder=0  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> </center> <h2 id=major_improvements_to_adjoint_sensitivities_with_ill-conditioning_stiffness ><a href="#major_improvements_to_adjoint_sensitivities_with_ill-conditioning_stiffness" class=header-anchor >Major Improvements to Adjoint Sensitivities with Ill-Conditioning &#40;Stiffness&#41;</a></h2> <p>Work in collaboration with the Deng Lab at MIT has lead to <a href="https://arxiv.org/abs/2103.15341">advances in stiff neural ordinary differential equations</a>. One of the main things that was shown is that you cannot just use a stiff ODE solver with the adjoints you had before and expect it to work: you need to use different adjoint techniques to do it stably and efficiently. We show precisely how to tackle some classically hard stiff ODEs and train neural networks on them using the latest techniques in <a href="https://github.com/SciML/DiffEqFlux.jl">DiffEqFlux.jl</a>. This is an extremely difficult domain but we hope to keep sharing new advances as they are available.</p> <h2 id=order_of_magnitude_performance_improvement_in_training_neural_odes_by_differentiating_the_solver ><a href="#order_of_magnitude_performance_improvement_in_training_neural_odes_by_differentiating_the_solver" class=header-anchor >Order of Magnitude Performance Improvement in Training Neural ODEs By Differentiating the Solver</a></h2> <p>SciML developers recently published a paper at ICML showing how to improve training performance of fast neural ODEs for machine learning applications &#40;image processing, natural language processing, etc.&#41; by using differentiating through the solver and <a href="https://arxiv.org/abs/2105.03918">regularizing based on internal solver heuristics</a>. Importantly, this is not an approach that can be done without defining something equivalent to differentiating the solver, showcasing that the <a href="http://ceur-ws.org/Vol-2587/article_8.pdf">generalized physics-informed approach through AD</a> has applications beyond SciML problems. We thank Avik Pal &#40;@avik-pal&#41; for doing a lot of the demonstrations in this work.</p> <h2 id=major_performance_improvements_to_neuralpde ><a href="#major_performance_improvements_to_neuralpde" class=header-anchor >Major Performance Improvements to NeuralPDE</a></h2> <p><a href="https://github.com/SciML/NeuralPDE.jl/pull/253">The recent work of Kirill Zubov</a> mixed with CUDA.jl 3.0 has led to some pretty major performance improvements with NeuralPDE.jl, particularly with GPUs. A formal benchmarking setup will be built in the near future to track performance in a more concrete way.</p> <h2 id=sciml_summer_projects_to_look_forward_to ><a href="#sciml_summer_projects_to_look_forward_to" class=header-anchor >SciML Summer Projects to Look Forward To</a></h2> <p>As summer is starting, it&#39;s time for the yearly update of all of the exciting announcements to expect soon. With 7 funded GSoC projects, 1 <a href="https://summer.iscas.ac.cn/#/org/orgdetail/julia?lang&#61;en">开源软件供应链点亮计划 - 暑期2021</a> project, and many funded members across top universities and technical computing companies dedicating their times to SciML, there is a huge list. But here&#39;s the quickest summary:</p> <ul> <li><p><a href="https://summerofcode.withgoogle.com/projects/?sp-page&#61;2#5357798591823872">Frank Shäfer</a> will be optimizing adjoints for neural hybrid differential equations and chaotic systems, as well as generalizing AD interfaces.</p> <li><p><a href="https://summerofcode.withgoogle.com/projects/?sp-page&#61;2#5463862406545408">Vasily Ilin</a> will be creating optimized methods for representing and simulating spatial stochastic simulations.</p> <li><p><a href="https://summerofcode.withgoogle.com/projects/?sp-page&#61;2#5493332257538048">Ilia Ilmer</a> will be adding routines for parameter identifiability analysis to ModelingToolkit.jl</p> <li><p><a href="https://summerofcode.withgoogle.com/projects/?sp-page&#61;5#4929042274320384">Mohammed Jeeshan Sheikh</a> will be working with Emmanuel Lujan and Tino Sultzer to build out the <a href="http://diffeqoperators.sciml.ai/dev/">DiffEqOperators</a> automated finite difference methods.</p> <li><p><a href="https://summerofcode.withgoogle.com/projects/?sp-page&#61;2#5673227164057600">Ashutosh Bharambe</a>, along with Zoe McCarthy and Kirill Zubov &#40;and many others&#33;&#41; will be continuing the push on <a href="https://github.com/SciML/NeuralPDE.jl">NeuralPDE.jl</a> for integro-differential equations and optimizing for multi-node multi-GPU workflows.</p> <li><p>As mentioned earlier <a href="https://summer.iscas.ac.cn/#/org/prodetail/210370695?lang&#61;en">Junpeng Gao</a> will work with Yingbo Ma to further optimize <code>QNDF</code> and building a pure-Julia equivalent to IDA.</p> <li><p>Yingbo Ma will be ensuring that ModelingToolkit becomes a complete acausal language &#40;and it already is basically there&#33; Stay tuned for the next blog post&#33;&#41;</p> </ul> <div class=page-foot > <div class=copyright > Website powered by <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia</a> programming language. </div> <div class=copyright > Edit on <a href="https://github.com/SciML/sciml.ai">GitHub</a> </div> </div> </div>