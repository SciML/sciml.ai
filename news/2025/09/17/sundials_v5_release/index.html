<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <meta property="og:title" content="SciML: Open Source Software for Scientific Machine Learning"> <meta property="og:description" content="Open Source Software for Scientific Machine Learning"> <meta property="og:image" content="https://sciml.ai/assets/SciMLGitHubPreview.png"> <meta property="og:url" content="https://sciml.ai"> <meta name="twitter:title" content=SciML > <meta name="twitter:description" content="Open Source Software for Scientific Machine Learning"> <meta name="twitter:image" content="https://sciml.ai/assets/SciMLGitHubPreview.png"> <meta name="twitter:card" content=summary_large_image > <!-- Favicon--> <link rel=icon  type="image/x-icon" href="assets/favicon.png" /> <!-- Bootstrap icons--> <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel=stylesheet  type="text/css" /> <link rel=stylesheet  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"> <!-- Google fonts--> <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel=stylesheet  type="text/css" /> <!-- Core theme CSS (includes Bootstrap)--> <link href="./css/styles.css" rel=stylesheet  /> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/styles.css"> <link rel=stylesheet  href="/css/hypertext.css"> <link rel=icon  href="/assets/favicon.png"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-90474609-2'); </script> <title>Sundials.jl v5.0: Update to SUNDIALS v7 and Improved DAE Initialization</title> <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin=anonymous ></script> <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin=anonymous ></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin=anonymous ></script> <div class=container-fluid  id=top-alert > <div class="alert alert-dark alert-dismissible mb-0" role=alert > <p class=text-center > <a href="https://youtu.be/yHiyJQdWBY8">Check out the latest talk: "The Continuing Advancements of Scientific Machine Learning (SciML)"</a> </p> <!-- <button type=button  class=close  data-dismiss=alert  aria-label=Close > <span aria-hidden=true >&times;</span> --> </button> </div> </div> <header> <nav class="navbar navbar-expand-lg navbar-light"> <a class=navbar-brand  href="/">Home</a> <button class=navbar-toggler  type=button  data-toggle=collapse  data-target="#navbarSupportedContent" aria-controls=navbarSupportedContent  aria-expanded=false  aria-label="Toggle navigation"> <span class=navbar-toggler-icon ></span> </button> <div class="collapse navbar-collapse" id=navbarSupportedContent > <ul class="navbar-nav mr-auto"> <li class="nav-item active"> <a class=nav-link  href="https://docs.sciml.ai/">Documentation</a> <li class=nav-item > <a class=nav-link  href="/news/">News</a> <li class=nav-item > <a class=nav-link  href="/roadmap/">Roadmap</a> <li class=nav-item > <a class=nav-link  href="/citing/">Citing</a> <li class=nav-item > <a class=nav-link  href="/showcase/">Showcase</a> <li class=nav-item > <a class=nav-link  href="https://benchmarks.sciml.ai/">Benchmarks</a> <li class=nav-item > <a class=nav-link  href="https://github.com/SciML/">GitHub</a> <li class="nav-item dropdown"> <a class="nav-link dropdown-toggle" href="#" id=navbarDropdownMenuLink  role=button  data-toggle=dropdown  aria-haspopup=true  aria-expanded=false > Community </a> <div class=dropdown-menu  aria-labelledby=navbarDropdownMenuLink > <a class=dropdown-item  href="/community/">Community Home</a> <a class=dropdown-item  href="/governance/">Governance</a> <a class=dropdown-item  href="/coc/">Code of Conduct</a> <a class=dropdown-item  href="/challenge/">Challenges</a> <a class=dropdown-item  href="/dev/">Developer Programs</a> </div> <li class=nav-item > <a class=nav-link  href="https://juliahub.com/company/contact-us-sciml"> Commercial Support </a> <li class=nav-item > <a class=nav-link  href="https://numfocus.org/donate-to-sciml"><i class="bi bi-heart"></i> Donate</a> </ul> </div> </nav> </header> <div class=franklin-content ><h1 id=sundialsjl_v50_update_to_sundials_v7_and_improved_dae_initialization ><a href="#sundialsjl_v50_update_to_sundials_v7_and_improved_dae_initialization" class=header-anchor >Sundials.jl v5.0: Update to SUNDIALS v7 and Improved DAE Initialization</a></h1> <p>We&#39;re excited to announce the release of <strong>Sundials.jl v5.0</strong>, a major update that brings significant improvements to differential-algebraic equation &#40;DAE&#41; solving, upgrades to the latest Sundials C library, and enhanced integration with the SciML ecosystem. This release includes important breaking changes designed to improve safety, clarity, and performance when solving DAEs.</p> <h2 id=why_the_breaking_changes_how_is_this_related_to_coming_differentialequationsjl_v8_and_ordinarydiffeq_v7_breaking_changes ><a href="#why_the_breaking_changes_how_is_this_related_to_coming_differentialequationsjl_v8_and_ordinarydiffeq_v7_breaking_changes" class=header-anchor >Why the Breaking Changes? How is this related to coming DifferentialEquations.jl v8 and OrdinaryDiffEq v7 breaking changes?</a></h2> <p>Sundials.jl is the first library in the set getting a major breaking change. If you aren&#39;t aware, check out the <a href="https://www.youtube.com/watch?v&#61;SZZ0lT8DVRo">the State of SciML extended edition</a> which discusses the major changes coming to the SciML differential equation solvers. The main things are:</p> <ol> <li><p>Simplifying the DifferentialEquations.jl library&#39;s dependencies to only be ODEs</p> <li><p>Simplifying OrdinaryDiffEq.jl&#39;s dependencies to just the standard default algorithms</p> <li><p>Changing the default DAE initialization to <code>CheckInit</code>, i.e. don&#39;t change <code>u0</code> without the user opting into allowing things to change &#40;except with ModelingToolkit.jl, because it strictly enforces equations vs guesses behavior&#41;</p> <li><p>No initialization ran by default after a callback, i.e. use the callback.initalizealg &#40;which defaults to <code>CheckInit</code>&#41; after a callback on a DAE</p> </ol> <p>While the &#40;1&#41; and &#40;2&#41; are not so related, &#40;3&#41; and &#40;4&#41; are breaking changes because what used to just <code>solve&#40;prob, IDA&#40;&#41;&#41;</code> would now be <code>solve&#40;prob, IDA&#40;&#41;, initializealg &#61; BrownFullBasicInit&#40;&#41;&#41;</code> as otherwise your <code>du0</code> guess needs to be correct. Is <code>du0</code> respected or a guess? Is <code>u0</code> respected or a guess? In the previous semanitcs it was a bit of &quot;it depends&quot;. Thus we have been wanting to impose a change to <code>CheckInit</code>, which means by default DAE consistency is checked and you get an error if the initial conditions are not consistent, but then it&#39;s easy to change to different documented behaviors:</p> <ul> <li><p><code>BrownFullBasicInit&#40;&#41;</code>: treat the differential variables as known and change <code>u0</code> for the algebraic variables, and also change <code>du0</code> to be consistent</p> <li><p><code>ShampineCollocationInit&#40;&#41;</code>: treat all initial values as guesses and change <code>u0</code>/<code>du0</code> to be consistent to the DAE definition</p> </ul> <p>Etc. With this, you never need to go &quot;wait, but I set <code>u0&#91;2&#93; &#61; 2.0...</code> but the solver then used <code>u0&#91;2&#93; &#61; 4.0</code>&#33;&quot;, with this change of semanitcs it will never change values without you declaring that it&#39;s a changable guess &#40;and ModelingToolkit.jl then keeps the same semantics, as that&#39;s the v10 semantics&#41;. This led to hard-to-debug issues where simulations would run but produce physically meaningless results. It was the documented semantics, but if users didn&#39;t know this detail, it can be very difficult for them to figure out why their initial conditions could be ignored. Thus we&#39;re prioritizing <strong>correctness and clarity</strong> over convenience. The new approach ensures users are aware of initialization requirements and can make informed decisions about their solving strategy.</p> <p>However... how do we roll this out across the ecosystem?</p> <p>It just so happened that other changes in the ecosystem made it possible to update the underlying SUNDIALS binary from v5.4 to v7, which itself is already a breaking change requiring a major. Thus to keep things simple, we have decided to also update the Sundials.jl initialization to its &quot;final form&quot;. DifferentialEquations.jl and OrdinaryDiffEq.jl will soon follow, hopefully before the end of the year.</p> <p>So with that said... let&#39;s get to the changes.</p> <h2 id=major_changes_in_v50 ><a href="#major_changes_in_v50" class=header-anchor >Major Changes in v5.0</a></h2> <h3 id=safer_dae_initialization_by_default ><a href="#safer_dae_initialization_by_default" class=header-anchor ><ol> <li><p>Safer DAE Initialization by Default</p> </ol> </a></h3> <p>The most significant change affects all users of the IDA solver for DAE problems. The new default behavior validates initial conditions rather than automatically modifying them.</p> <p><strong>Before &#40;v4.x&#41;:</strong> Automatic initialization could silently change the <code>u0</code> parts for the algebraic variables.</p> <pre><code class="julia hljs">prob = DAEProblem(f, du0, u0, tspan, differential_vars=differential_vars)
sol = solve(prob, IDA())  <span class=hljs-comment ># Might change `u0` before solving, specifically the algebraic variables by default</span></code></pre> <p><strong>After &#40;v5.0&#41;:</strong> Explicit initialization choice required</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> DiffEqBase: BrownFullBasicInit

prob = DAEProblem(f, du0, u0, tspan, differential_vars=differential_vars)

sol = solve(prob, IDA()) <span class=hljs-comment ># Solves with CheckInit, i.e. it fails if `(du0, u0, p, t)` is not consistent</span>

<span class=hljs-comment ># Option 1: Request automatic initialization of algebraic variables (recommended for most users)</span>
<span class=hljs-comment ># Automatically changes the part of `u0` for the algebraic variables and all of `du0` to get a consistent set</span>
sol = solve(prob, IDA(), initializealg=BrownFullBasicInit()) 

<span class=hljs-comment ># Option 2: Request automatic initialization of all variables</span>
<span class=hljs-comment ># Automatically changes `u0` and `du0` to get a consistent set</span>
sol = solve(prob, IDA(), initializealg=ShampineCollocationInit())</code></pre> <h3 id=available_initialization_algorithms ><a href="#available_initialization_algorithms" class=header-anchor >Available Initialization Algorithms</a></h3> <p>Sundials.jl v5.0 supports multiple initialization strategies through the <code>initializealg</code> parameter:</p> <ul> <li><p><strong><code>DefaultInit&#40;&#41;</code></strong>: Intelligently chooses the appropriate algorithm based on your problem</p> <li><p><strong><code>BrownFullBasicInit&#40;&#41;</code></strong>: Brown&#39;s algorithm for index-1 DAEs &#40;requires differential_vars&#41;</p> <li><p><strong><code>ShampineCollocationInit&#40;&#41;</code></strong>: Shampine&#39;s collocation method &#40;works without differential_vars&#41;</p> <li><p><strong><code>CheckInit&#40;&#41;</code></strong>: Only validates initial conditions without modification</p> </ul> <h3 id=ol_start2_upgrade_to_sundials_v7_c_library ><a href="#ol_start2_upgrade_to_sundials_v7_c_library" class=header-anchor ><ol start=2 > <li><p>Upgrade to Sundials v7 C Library</p> </ol> </a></h3> <p>We&#39;ve upgraded from Sundials v5 to v7, bringing improved performance and new features. This introduces breaking changes for users of the low-level C API:</p> <p><strong>Key Change:</strong> All Sundials objects now require a <code>SUNContext</code> for thread safety and better resource management.</p> <p>If you&#39;re using the high-level DiffEq interface &#40;<code>solve&#40;prob, CVODE_BDF&#40;&#41;&#41;</code>&#41;, <strong>no changes are needed</strong>. The context is managed automatically. However, low-level API users need to update their code:</p> <pre><code class="julia hljs"><span class=hljs-comment ># Old (v4.x)</span>
mem_ptr = CVodeCreate(CV_BDF)

<span class=hljs-comment ># New (v5.0)</span>
ctx_ptr = <span class=hljs-built_in >Ref</span>{SUNContext}(<span class=hljs-literal >C_NULL</span>)
SUNContext_Create(<span class=hljs-literal >C_NULL</span>, Base.unsafe_convert(<span class=hljs-built_in >Ptr</span>{SUNContext}, ctx_ptr))
ctx = ctx_ptr[]
mem_ptr = CVodeCreate(CV_BDF, ctx)
<span class=hljs-comment ># ... use solver ...</span>
SUNContext_Free(ctx)</code></pre> <h3 id=ol_start3_enhanced_modelingtoolkit_integration ><a href="#ol_start3_enhanced_modelingtoolkit_integration" class=header-anchor ><ol start=3 > <li><p>Enhanced ModelingToolkit Integration</p> </ol> </a></h3> <p>IDA, CVODE and ARKODE now fully support the <code>initializealg</code> parameter, enabling seamless integration with ModelingToolkit&#39;s parameter initialization system. This is particularly important for large-scale models with complex initialization requirements.</p> <pre><code class="julia hljs"><span class=hljs-comment ># Automatic handling of ModelingToolkit initialization</span>
sol = solve(prob, CVODE_BDF())  <span class=hljs-comment ># Uses DefaultInit() which detects MTK requirements, i.e. OverrideInit()</span></code></pre> <h2 id=migration_guide ><a href="#migration_guide" class=header-anchor >Migration Guide</a></h2> <h3 id=for_most_users ><a href="#for_most_users" class=header-anchor >For Most Users</a></h3> <p>If you&#39;re using IDA for DAE problems, you&#39;ll need to explicitly specify an initialization algorithm:</p> <ol> <li><p><strong>Have differential_vars?</strong> Use <code>BrownFullBasicInit&#40;&#41;</code>:</p> </ol> <pre><code class="julia hljs">sol = solve(prob, IDA(), initializealg=BrownFullBasicInit())</code></pre>
<ol start=2 >
<li><p><strong>No differential_vars?</strong> Use <code>ShampineCollocationInit&#40;&#41;</code>:</p>

</ol>
<pre><code class="julia hljs">sol = solve(prob, IDA(), initializealg=ShampineCollocationInit())</code></pre>
<ol start=3 >
<li><p><strong>Already have consistent initial conditions?</strong> The default <code>CheckInit&#40;&#41;</code> will validate them</p>

</ol>
<h3 id=error_messages_guide_you ><a href="#error_messages_guide_you" class=header-anchor >Error Messages Guide You</a></h3>
<p>If you forget to update your code, you&#39;ll receive clear error messages explaining what&#39;s needed:</p>
<pre><code class="julia hljs">DAE initialization failed with CheckInit: Initial conditions <span class=hljs-keyword >do</span> not satisfy the DAE constraints.

Suggestions:
<span class=hljs-number >1.</span> Use an initialization algorithm: initializealg = BrownFullBasicInit()
<span class=hljs-number >2.</span> Provide consistent initial conditions that satisfy f(du0, u0, p, t0) = <span class=hljs-number >0</span></code></pre>
<h2 id=benefits_of_the_new_approach ><a href="#benefits_of_the_new_approach" class=header-anchor >Benefits of the New Approach</a></h2>
<ol>
<li><p><strong>Safety</strong>: No more silent failures from incorrect automatic initialization</p>

<li><p><strong>Clarity</strong>: Explicit initialization choices make code more maintainable</p>

<li><p><strong>Performance</strong>: Skip unnecessary computations when you have consistent initial conditions</p>

<li><p><strong>Debugging</strong>: Clear error messages when initialization fails</p>

<li><p><strong>Flexibility</strong>: Choose the best initialization algorithm for your specific problem</p>

</ol>
<h2 id=looking_forward ><a href="#looking_forward" class=header-anchor >Looking Forward</a></h2>
<p>While breaking changes are never easy, we believe these updates position Sundials.jl for a more robust and reliable future. The explicit initialization approach aligns with best practices in numerical computing: be explicit about your assumptions and requirements.</p>
<p>The upgrade to Sundials v7 also opens doors for future enhancements, including better GPU support and improved parallel solving capabilities that we plan to expose in future releases.</p>
<h2 id=acknowledgments ><a href="#acknowledgments" class=header-anchor >Acknowledgments</a></h2>
<p>We thank the entire SciML community for their feedback and patience as we worked through these important changes. Special thanks to the Sundials team at LLNL for their continued development of the underlying C library.</p>
<p>If you encounter any issues during migration, please don&#39;t hesitate to open an issue on the <a href="https://github.com/SciML/Sundials.jl">Sundials.jl GitHub repository</a> or ask questions on the <a href="https://discourse.julialang.org/">Julia Discourse</a> forums.</p>
<!-- Footer-->
<footer class="footer bg-light">
  <div class=container >
      <div class=row >
          <div class="col-lg-6 h-100 text-center text-lg-start my-auto">
              <ul class="list-inline mb-2">
                  
                  <li class=list-inline-item ><a href="/community">Contact</a>
                  <!-- <li class=list-inline-item ><a href="#!">Terms of Use</a>
                  <li class=list-inline-item ><a href="#!">Privacy Policy</a> -->
              </ul>
              <p class="text-muted small mb-4 mb-lg-0">Website powered by <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia</a> programming language. &copy; SciML 2022. All Rights Reserved.</p>
              <p class="text-muted small mb-4 mb-lg-0">Edit on <a href="https://github.com/SciML/sciml.ai">GitHub</a></p>

            </div>
          <div class="col-lg-6 h-100 text-center text-lg-end my-auto">
              <ul class="list-inline mb-0">
                  <li class="list-inline-item me-4">
                      <a href="https://github.com/SciML"><i class="bi-github fs-3"></i></a>
                  
                  <li class="list-inline-item me-4">
                      <a href="https://twitter.com/SciML_Org"><i class="bi-twitter fs-3"></i></a>
                  
                  <li class=list-inline-item >
                      <a href="https://www.linkedin.com/company/the-julia-language"><i class="bi-linkedin fs-3"></i></a>
                  
              </ul>
          </div>
      </div>
  </div>
</footer>
</div>